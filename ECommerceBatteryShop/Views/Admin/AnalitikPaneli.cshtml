@model ECommerceBatteryShop.Models.ProductSalesAnalyticsViewModel
@using System.Globalization
@{
    ViewData["Title"] = "Ürün Analitikleri";
    Layout = "_AdminLayout";
    var totalPages = (int)Math.Ceiling((double)Model.TotalCount / Model.PageSize);
    if (totalPages <= 0) totalPages = 1;
}

<div class="mx-auto max-w-7xl space-y-6">
  <header class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
    <div>
      <p class="text-xs font-semibold uppercase tracking-wide text-slate-500">Analitik</p>
      <h1 class="text-2xl font-semibold text-slate-900">Ürün Bazlý Satýþlar</h1>
      <p class="text-sm text-slate-500">Her ürün için toplam satýlan adet. Arama ve sayfalama ile filtreleyin.</p>
    </div>
    <form method="get" class="flex items-center gap-2">
      <input type="text" name="q" value="@Model.Search" placeholder="Ürün adý ile ara" class="rounded-full border border-slate-300 px-4 py-2 text-sm" />
      <button type="submit" class="rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white">Ara</button>
    </form>
  </header>

  <div class="overflow-hidden rounded-2xl border border-slate-200">
    <table class="min-w-full divide-y divide-slate-100 text-sm">
      <thead class="bg-slate-50/80 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">
        <tr>
          <th class="px-4 py-3">Ürün</th>
          <th class="px-4 py-3">Fiyat (USD)</th>
          <th class="px-4 py-3">Satýlan Adet</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-100 bg-white">
        @foreach (var p in Model.Items)
        {
          <tr>
            <td class="px-4 py-3">
              <div class="flex items-center gap-3">
                <img src="@(string.IsNullOrWhiteSpace(p.ImageUrl) ? "/img/temsili.png" : (p.ImageUrl.StartsWith("/img/")? p.ImageUrl : "/img/" + p.ImageUrl))" alt="@p.Name" class="h-10 w-10 rounded object-cover border border-slate-200" />
                <div>
                  <div class="font-semibold text-slate-900">@p.Name</div>
                  <div class="text-xs text-slate-500">#@p.ProductId</div>
                </div>
              </div>
            </td>
            <td class="px-4 py-3 font-medium text-slate-900">$@p.Price</td>
            <td class="px-4 py-3 font-semibold text-slate-900">@p.SoldUnits</td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <nav class="flex items-center justify-between">
    <div class="text-xs text-slate-600">
      Toplam @Model.TotalCount kayýt · Sayfa @Model.Page / @totalPages
    </div>
    <ul class="inline-flex overflow-hidden rounded-full border border-slate-200 text-sm">
      @{
        var prev = Model.Page > 1 ? Model.Page - 1 : 1;
        var next = Model.Page < totalPages ? Model.Page + 1 : totalPages;
        var q = string.IsNullOrWhiteSpace(Model.Search) ? null : Model.Search;
      }
      <li>
        <a class="block px-4 py-2 hover:bg-slate-50 @((Model.Page==1)?"pointer-events-none opacity-50":"")" href="@Url.Action("UrunAnalitikleri","Admin", new { q, page = prev })">Önceki</a>
      </li>
      @for (var i = 1; i <= totalPages; i++)
      {
        <li>
          <a class="block px-4 py-2 hover:bg-slate-50 @(i==Model.Page?"bg-slate-900 text-white":"")" href="@Url.Action("UrunAnalitikleri","Admin", new { q, page = i })">@i</a>
        </li>
      }
      <li>
        <a class="block px-4 py-2 hover:bg-slate-50 @((Model.Page==totalPages)?"pointer-events-none opacity-50":"")" href="@Url.Action("UrunAnalitikleri","Admin", new { q, page = next })">Sonraki</a>
      </li>
    </ul>
  </nav>
</div>

