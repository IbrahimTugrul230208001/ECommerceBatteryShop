@using System.Text.Json
@model IReadOnlyList<ECommerceBatteryShop.Models.AddressViewModel>

@{
    var addresses = Model ?? Array.Empty<ECommerceBatteryShop.Models.AddressViewModel>();
    var jsonOptions = new JsonSerializerOptions(JsonSerializerDefaults.Web);
}

<div id="address-list" class="mt-6 grid gap-4 md:grid-cols-2">
    @if (!addresses.Any())
    {
        <div class="rounded-xl border border-dashed border-slate-300 p-6 text-center text-sm text-slate-500">
            Henüz kayıtlı adresiniz yok. Yeni bir adres eklemek için yukarıdaki butonu kullanın.
        </div>
    }
    else
    {
        foreach (var address in addresses)
        {
            var payload = JsonSerializer.Serialize(new
            {
                id = address.Id,
                title = address.Title,
                name = address.Name,
                surname = address.Surname,
                phoneNumber = address.PhoneNumber,
                fullAddress = address.FullAddress,
                city = address.City,
                state = address.State,
                country = address.Country,
                neighbourhood = address.Neighbourhood,
                isDefault = address.IsDefault
            }, jsonOptions);
            var cardClasses = address.IsDefault
                ? "rounded-xl border-2 border-amber-300 bg-amber-50 p-4"
                : "rounded-xl border border-gray-100 p-4";
            <article class="@cardClasses">
                <div class="flex items-center justify-between gap-2">
                    <p class="text-sm font-semibold text-gray-900">@address.Title</p>
                    @if (address.IsDefault)
                    {
                        <span class="rounded-full bg-amber-200 px-3 py-1 text-xs font-semibold text-amber-700">Varsayılan</span>
                    }
                </div>
                <p class="mt-2 text-sm text-gray-700 font-medium">@address.Name @address.Surname</p>
                <p class="text-sm text-gray-500">@address.PhoneNumber</p>
                <p class="mt-3 text-sm text-gray-600 whitespace-pre-line">@address.FullAddress</p>
                <p class="text-xs text-gray-500 mt-2">@address.Neighbourhood, @address.State / @address.City</p>

                <div class="mt-4 flex flex-wrap items-center gap-2 text-xs">
                    <button type="button"
                            class="rounded-full border border-gray-200 px-3 py-1 text-gray-600 transition hover:border-amber-300 hover:text-amber-600"
                            @@click="$store.address.edit(@Html.Raw(payload))">
                        Düzenle
                    </button>
                    @if (!address.IsDefault)
                    {
                        <form method="post"
                              hx-post="@Url.Action("SetDefault", "Address")"
                              hx-target="#address-list"
                              hx-swap="outerHTML"
                              class="contents">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="id" value="@address.Id" />
                            <button type="submit"
                                    class="rounded-full border border-gray-200 px-3 py-1 text-gray-600 transition hover:border-amber-300 hover:text-amber-600">
                                Varsayılan Yap
                            </button>
                        </form>
                    }
                    else
                    {
                        <button type="button" disabled
                                class="rounded-full border border-amber-300 bg-amber-100 px-3 py-1 text-amber-600">
                            Varsayılan
                        </button>
                    }
                </div>
            </article>
        }
    }
</div>
