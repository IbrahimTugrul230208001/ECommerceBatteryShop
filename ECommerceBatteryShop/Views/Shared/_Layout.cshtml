@using ECommerceBatteryShop.Domain.Entities
@using ECommerceBatteryShop.Services
@using System.Linq
@inject ECommerceBatteryShop.DataAccess.Abstract.ICategoryRepository CategoryRepository
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Antiforgery
@inject ICartService CartService
@{
    var categories = await CategoryRepository.GetCategoriesWithChildrenAsync();
    categories = categories
        .Where(c => c.ProductCategories.Any() || c.SubCategories.Any(sc => sc.ProductCategories.Any()))
        .Select(c =>
        {
            c.SubCategories = c.SubCategories.Where(sc => sc.ProductCategories.Any()).ToList();
            return c;
        })
        .ToList();

    var cartCount = 0;
    var cookieConsent = Context.Request.Cookies["COOKIE_CONSENT"];
    var cookiesRejected = string.Equals(cookieConsent, "rejected", System.StringComparison.OrdinalIgnoreCase);
    if (User.Identity?.IsAuthenticated == true)
    {
        var userIdClaim = User.FindFirst("sub")?.Value;
        if (int.TryParse(userIdClaim, out var userId))
        {
            cartCount = await CartService.CountAsync(CartOwner.FromUser(userId));
        }
    }
    else
    {
        var anonId = cookiesRejected ? null : Context.Request.Cookies["ANON_ID"];
        if (!string.IsNullOrEmpty(anonId))
        {
            cartCount = await CartService.CountAsync(CartOwner.FromAnon(anonId));
        }
    }
    var cartText = cartCount > 99 ? "99+" : cartCount.ToString();
    var isAuthenticated = User.Identity?.IsAuthenticated == true;
    var accountUrl = isAuthenticated
        ? Url.Action("Profile", "Account") ?? "/Account/Profile"
        : Url.Action("Register", "Account") ?? "/Account/Register";
    var accountText = isAuthenticated ? "HesabÄ±m" : "Ãœye Ol";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="request-verification-token" content="@Antiforgery.GetAndStoreTokens(Context).RequestToken" />
    <title>
        Dayily Enerji - Lityum Enerji Depolama Sistemleri, Perakende Pil ve BataryaÂ MalzemeleriÂ ðŸ”‹
   </title>
    <link rel="icon" href="/img/logo_mini.png" type="jpeg">
    <link rel="stylesheet" href="~/css/output.css"/>
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
</head>
<body>
    <header x-data="{ overlay:false, mobileCategories:false }" @@keydown.escape.window="overlay=false; mobileCategories=false" class="relative z-40">

       
        <!-- MOBILE BAR -->
        <div class="md:hidden bg-gray-900 text-white relative z-50">
            <div class="mx-auto max-w-7xl px-4 h-14 flex items-center gap-3 py-6">
                <!-- Category toggle & Search -->
                <div class="flex-1 relative">
                    <div class="flex items-center gap-2">
                        <button type="button"
                                aria-controls="mobile-category-menu"
                                :aria-expanded="mobileCategories"
                                @@click="mobileCategories = !mobileCategories; overlay = mobileCategories"
                                class="inline-flex h-10 w-10 items-center justify-center rounded-md border border-white/20 bg-white/5 text-white transition hover:bg-white/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-300">
                            <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="4" y1="6" x2="20" y2="6" />
                                <line x1="4" y1="12" x2="20" y2="12" />
                                <line x1="4" y1="18" x2="16" y2="18" />
                            </svg>
                            <span class="sr-only">Kategorileri aÃ§</span>
                        </button>

                        <div class="flex-1 relative">
                            <form method="get" action="/Product/Index" class="h-10 rounded-md border border-gray-300 bg-white overflow-hidden focus-within:ring-2 focus-within:ring-amber-400 focus-within:border-amber-400">

                                <!-- Search icon -->
                                <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-500 pointer-events-none"
                                     xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <circle cx="11" cy="11" r="7" stroke-width="2" />
                                    <path d="M21 21l-4.3-4.3" stroke-width="2" />
                                </svg>

                                <!-- Input -->
                                <input name="q"
                                       type="search"
                                       placeholder="Ara..."
                                       hx-get="/Product/Search"
                                       hx-trigger="keyup changed delay:300ms"
                                       hx-target="#search-predictions-mobile"
                                       hx-indicator="#search-spinner-mobile"
                                       autocomplete="off"
                                       @@focus="overlay=true" @@blur="overlay=false"
                                       class="w-full pl-10 pr-10 text-black placeholder-gray-500 focus:outline-none h-10" />

                                <!-- Submit button -->
                                <button type="submit" aria-label="Search"
                                        class="absolute cursor-pointer right-0 top-0 rounded-r-lg h-10 px-3 bg-amber-300 hover:bg-amber-400 grid place-items-center">
                                    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none">
                                        <circle cx="9.14" cy="9.14" r="7.64" stroke="#020202" stroke-width="1.9"></circle>
                                        <line x1="22.5" y1="22.5" x2="14.39" y2="14.39" stroke="#020202" stroke-width="1.9"></line>
                                    </svg>
                                </button>

                                <!-- Spinner -->
                                <span id="search-spinner-mobile"
                                      class="htmx-indicator absolute right-12 top-1/2 -translate-y-1/2 text-gray-500 hidden">
                                    YÃ¼kleniyor...
                                </span>
                            </form>
                            <div id="search-predictions-mobile"
                                 class="absolute top-full left-0 w-full max-h-104 overflow-y-auto rounded-md shadow-2xl bg-white text-black z-50 hidden"
                                 hx-swap="innerHTML"
                                 hx-on:htmx:afterSwap="this.classList.toggle('hidden', this.innerHTML.trim()==='')">
                            </div>
                        </div>
                    </div>

                    <div id="mobile-category-menu"
                         x-cloak
                         x-show="mobileCategories"
                         x-transition.origin.top.left
                         class="absolute left-0 right-0 top-full z-50 mt-3 max-h-96 overflow-y-auto rounded-2xl border border-gray-200 bg-white text-gray-900 shadow-2xl"
                         @@click.outside="mobileCategories=false; overlay=false">
                        <nav aria-label="Mobil kategoriler" class="p-4">
                            <ul class="space-x-4">
                                @foreach (var parent in categories)
                                {
                                    <li class="space-y-3">
                                        <a href="@Url.Action("Index", "Product", new { categoryId = parent.Id })"
                                           class="flex items-center justify-between text-base font-semibold text-gray-900 hover:text-amber-500">
                                            <span>@parent.Name</span>
                                            @if (parent.SubCategories != null && parent.SubCategories.Any())
                                            {
                                                <svg class="h-4 w-4 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.939l3.71-3.71a.75.75 0 111.06 1.062l-4.24 4.24a.75.75 0 01-1.06 0l-4.24-4.24a.75.75 0 01.02-1.06z" clip-rule="evenodd" /></svg>
                                            }
                                        </a>
                                        @if (parent.SubCategories != null && parent.SubCategories.Any())
                                        {
                                            <ul class="space-y-2 pl-3 text-sm text-gray-600">
                                                @foreach (var child in parent.SubCategories)
                                                {
                                                    <li>
                                                        <a href="@Url.Action("Index", "Product", new { categoryId = child.Id })"
                                                           class="block rounded-md font-semibold px-2 py-1.5 hover:bg-gray-100 hover:text-gray-900">@child.Name</a>
                                                    </li>
                                                }
                                            </ul>
                                        }
                                    </li>
                                }
                                <li>
                                    <a href="/Home/Contact" class="block text-base font-semibold text-gray-900 hover:text-amber-500">Ä°letiÅŸim</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>


            </div>
        </div>

            <div id="overlay"
                 class="fixed inset-0 z-40 bg-black/70 transition-opacity duration-200
              opacity-0 pointer-events-none"
                 :class="(overlay || mobileCategories) ? 'opacity-100 pointer-events-auto' : ''"
                 @@click="overlay=false; mobileCategories=false"></div>
        <!-- add this -->
        <!-- TABLET NAVBAR -->
        <nav x-data="{ scrolled:false }"
             @@scroll.window.passive ="scrolled = window.scrollY > 0"
             class="fixed top-0 inset-x-0 z-50 bg-gray-900 text-white hidden md:block lg:hidden transition-shadow duration-200 h-20"
             :class="scrolled ? 'shadow-md bg-gray-900/90 backdrop-blur' : ''">
            <div class="mx-auto max-w-[95%] px-4 h-full flex items-center gap-6">
                <!-- Logo -->
                <div>
                    <a href="/Home/Index"
                       class="flex-none text-xl font-bold hover:text-gray-300">
                        <img src="~/img/logo.png" alt="Logo" class="h-16 w-auto object-contain" />
                    </a>

                </div>

                <!-- Search -->
                    <div class="flex-1">
                        <!-- wrapper controls positioning -->
                        <div class="relative">

                            <!-- Input box -->
                            <form method="get" action="/Product/Index" class="h-10 rounded-md border border-gray-300 bg-white overflow-hidden focus-within:ring-2 focus-within:ring-amber-400 focus-within:border-amber-400">

                                <!-- Search icon -->
                                <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-500 pointer-events-none"
                                     xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <circle cx="11" cy="11" r="7" stroke-width="2" />
                                    <path d="M21 21l-4.3-4.3" stroke-width="2" />
                                </svg>

                                <!-- Input -->
                                <input name="q"
                                       type="search"
                                       placeholder="Ara..."
                                       hx-get="/Product/Search"
                                       hx-trigger="keyup changed delay:300ms"
                                       hx-target="#search-predictions-tablet"
                                       hx-indicator="#search-spinner-tablet"
                                       autocomplete="off"
                                       @@focus="overlay=true" @@blur="overlay=false"
                                       class="w-full pl-10 pr-10 text-black placeholder-gray-500 focus:outline-none h-10" />

                                <!-- Submit button -->
                                <button type="submit" aria-label="Search"
                                        class="absolute cursor-pointer right-0 top-0 rounded-r-lg h-10 px-3 bg-amber-300 hover:bg-amber-400 grid place-items-center">
                                    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none">
                                        <circle cx="9.14" cy="9.14" r="7.64" stroke="#020202" stroke-width="1.9"></circle>
                                        <line x1="22.5" y1="22.5" x2="14.39" y2="14.39" stroke="#020202" stroke-width="1.9"></line>
                                    </svg>
                                </button>

                                <!-- Spinner -->
                                <span id="search-spinner-tablet"
                                      class="htmx-indicator absolute right-12 top-1/2 -translate-y-1/2 text-gray-500 hidden">
                                    YÃ¼kleniyor...
                                </span>
                            </form>
                            <!-- Predictions dropdown (sibling, not inside input box) -->
                            <div id="search-predictions-tablet"
                                 class="absolute top-full left-0 w-full max-h-104 overflow-y-auto
            rounded-md shadow-2xl bg-white text-black z-50 hidden"
                                 hx-swap="innerHTML"
                                 hx-on:htmx:afterSwap="this.classList.toggle('hidden', this.innerHTML.trim()==='')">
                            </div>

                        </div>
                    </div>


                <div class="flex gap-3">
                <!-- Cart -->
                    <!-- Sepet -->
                    <a href="/Cart/Index" aria-label="Sepet (@cartText Ã¼rÃ¼n)"
                       class="group relative inline-flex items-center gap-2 h-16 px-4 shrink-0 rounded-md
   transition duration-150 cursor-pointer hover:bg-white/5 hover:scale-105
   focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-400">

                        <span class="relative inline-flex">
                            <svg xmlns="http://www.w3.org/2000/svg"
                                 class="h-8 w-8 text-white transition-colors duration-150 group-hover:text-amber-300"
                                 viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                 stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M6.3 5H21L19 12H7.38M20 16H8L6 3H3M9 20a1 1 0 1 1-2 0a1 1 0 0 1 2 0ZM20 20a1 1 0 1 1-2 0a1 1 0 0 1 2 0Z" />
                            </svg>

                            <span id="cart-count-tablet" class="absolute -top-1 -right-1 min-w-[1.25rem] h-5 px-1 rounded-full text-xs font-medium
            bg-amber-300 text-gray-900 grid place-items-center ring-1 ring-black/10
            transition duration-150">
                                    @cartText
                            </span>
                        </span>
                    </a>

                    <!-- Favoriler -->
                    <a href="/Favorites/Index" aria-label="Favoriler"
                       class="group relative inline-flex items-center gap-2 h-16 px-4 shrink-0 rounded-md
   transition duration-150 cursor-pointer hover:bg-white/5 hover:scale-105
   focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-300">

                        <span class="relative inline-flex">
                            <svg class="h-8 w-8 text-white transition-colors duration-150 group-hover:text-amber-300"
                                 viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                      d="M11.993 5.09691C11.0387 4.25883 9.78328 3.75 8.40796 3.75C5.42122 3.75 3 6.1497 3 9.10988C3 10.473 3.50639 11.7242 4.35199 12.67L12 20.25L19.4216 12.8944L19.641 12.6631C20.4866 11.7172 21 10.473 21 9.10988C21 6.1497 18.5788 3.75 15.592 3.75C14.2167 3.75 12.9613 4.25883 12.007 5.09692L12 5.08998L11.993 5.09691ZM12 7.09938L12.0549 7.14755L12.9079 6.30208L12.9968 6.22399C13.6868 5.61806 14.5932 5.25 15.592 5.25C17.763 5.25 19.5 6.99073 19.5 9.10988C19.5 10.0813 19.1385 10.9674 18.5363 11.6481L18.3492 11.8453L12 18.1381L5.44274 11.6391C4.85393 10.9658 4.5 10.0809 4.5 9.10988C4.5 6.99073 6.23699 5.25 8.40796 5.25C9.40675 5.25 10.3132 5.61806 11.0032 6.22398L11.0921 6.30203L11.9452 7.14752L12 7.09938Z" />
                            </svg>
                        </span>
                    </a>

                <!-- Account / Profile -->
                    <a href="@accountUrl" aria-label="@accountText"
                       class="group inline-flex items-center justify-center px-4 h-16 cursor-pointer rounded-md
   transition hover:bg-white/10 hover:scale-105 focus-visible:outline-none
   focus-visible:ring-2 focus-visible:ring-amber-400">
                        <div class="relative inline-flex transition-transform duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg"
                                 class="h-8 w-8 text-white transition-colors duration-200 group-hover:text-amber-300"
                                 viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                 stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M16 7a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z" />
                                <path d="M4 21v-2a4 4 0 0 1 4-4h8a4 4 0 0 1 4 4v2" />
                            </svg>
                        </div>
                    </a>
                </div>
            </div>
        </nav>

        <!-- DESKTOP NAVBAR -->
        <nav x-data="{ scrolled:false }"
             @@scroll.window.passive ="scrolled = window.scrollY > 0"
             class="fixed top-0 inset-x-0 z-50 bg-gray-900 text-white hidden lg:block transition-shadow duration-200 h-20"
             :class="scrolled ? 'shadow-md bg-gray-900/90 backdrop-blur' : ''">
            <div class="mx-auto max-w-[95%] px-4 h-full flex items-center gap-10">
                <!-- Logo -->
                <div>
                    <a href="/Home/Index"
                       class="flex-none text-xl font-bold hover:text-gray-300">
                        <img src="~/img/logo.png" alt="Logo" class="h-16 w-auto object-contain" />
                    </a>

                </div>
                
                <!-- Search -->
                    <div class="flex-1">
                        <!-- wrapper controls positioning -->
                        <div class="relative">

                            <!-- Input box -->
                            <form method="get" action="/Product/Index" class="h-10 rounded-md border border-gray-300 bg-white overflow-hidden focus-within:ring-2 focus-within:ring-amber-400 focus-within:border-amber-400">

                                <!-- Search icon -->
                                <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-500 pointer-events-none"
                                     xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <circle cx="11" cy="11" r="7" stroke-width="2" />
                                    <path d="M21 21l-4.3-4.3" stroke-width="2" />
                                </svg>

                                <!-- Input -->
                                <input name="q"
                                       type="search"
                                       placeholder="Ara..."
                                       hx-get="/Product/Search"
                                       hx-trigger="keyup changed delay:300ms"
                                       hx-target="#search-predictions-desktop"
                                       hx-indicator="#search-spinner-desktop"
                                       autocomplete="off"
                                       @@focus="overlay=true" @@blur="overlay=false"
                                       class="w-full pl-10 pr-10 text-black placeholder-gray-500 focus:outline-none h-10" />

                                <!-- Submit button -->
                                <button type="submit" aria-label="Search"
                                        class="absolute cursor-pointer right-0 top-0 rounded-r-lg h-10 px-3 bg-amber-300 hover:bg-amber-400 grid place-items-center">
                                    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none">
                                        <circle cx="9.14" cy="9.14" r="7.64" stroke="#020202" stroke-width="1.9"></circle>
                                        <line x1="22.5" y1="22.5" x2="14.39" y2="14.39" stroke="#020202" stroke-width="1.9"></line>
                                    </svg>
                                </button>

                                <!-- Spinner -->
                                <span id="search-spinner-desktop"
                                      class="htmx-indicator absolute right-12 top-1/2 -translate-y-1/2 text-gray-500 hidden">
                                    YÃ¼kleniyor...
                                </span>
                            </form>
                            <!-- Predictions dropdown (sibling, not inside input box) -->
                            <div id="search-predictions-desktop"
                                 class="absolute top-full left-0 w-full max-h-104 overflow-y-auto
            rounded-md shadow-2xl bg-white text-black z-50 hidden"
                                 hx-swap="innerHTML"
                                 hx-on:htmx:afterSwap="this.classList.toggle('hidden', this.innerHTML.trim()==='')">
                            </div>

                        </div>
                    </div>


                <div class="flex gap-3">
                <!-- Cart -->
                    <!-- Sepet -->
                  

                  
                <!-- Account / Profile -->
                    <a href="@accountUrl" aria-label="@accountText"
                       class="group inline-flex items-center justify-center px-4 h-16 cursor-pointer rounded-md
   transition hover:bg-white/10 hover:scale-105 focus-visible:outline-none
   focus-visible:ring-2 focus-visible:ring-amber-400">
                        <div class="relative inline-flex transition-transform duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg"
                                 class="h-8 w-8 text-white transition-colors duration-200 group-hover:text-amber-300"
                                 viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                 stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M16 7a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z" />
                                <path d="M4 21v-2a4 4 0 0 1 4-4h8a4 4 0 0 1 4 4v2" />
                            </svg>
                        </div>
                        <span class="ml-2 text-white text-md font-semibold transition-colors duration-200 group-hover:text-amber-300">
                            @accountText
                        </span>
                    </a>

                    <!-- Favoriler -->
                    <a href="/Favorites/Index" aria-label="Favoriler"
                       class="group relative inline-flex items-center gap-2 h-16 px-4 shrink-0 rounded-md
   transition duration-150 cursor-pointer hover:bg-white/5 hover:scale-105
   focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-300">

                        <span class="relative inline-flex">
                            <svg class="h-8 w-8 text-white transition-colors duration-150 group-hover:text-amber-300"
                                 viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                      d="M11.993 5.09691C11.0387 4.25883 9.78328 3.75 8.40796 3.75C5.42122 3.75 3 6.1497 3 9.10988C3 10.473 3.50639 11.7242 4.35199 12.67L12 20.25L19.4216 12.8944L19.641 12.6631C20.4866 11.7172 21 10.473 21 9.10988C21 6.1497 18.5788 3.75 15.592 3.75C14.2167 3.75 12.9613 4.25883 12.007 5.09692L12 5.08998L11.993 5.09691ZM12 7.09938L12.0549 7.14755L12.9079 6.30208L12.9968 6.22399C13.6868 5.61806 14.5932 5.25 15.592 5.25C17.763 5.25 19.5 6.99073 19.5 9.10988C19.5 10.0813 19.1385 10.9674 18.5363 11.6481L18.3492 11.8453L12 18.1381L5.44274 11.6391C4.85393 10.9658 4.5 10.0809 4.5 9.10988C4.5 6.99073 6.23699 5.25 8.40796 5.25C9.40675 5.25 10.3132 5.61806 11.0032 6.22398L11.0921 6.30203L11.9452 7.14752L12 7.09938Z" />
                            </svg>
                        </span>

                        <span class="text-white text-md font-semibold transition-colors duration-150 group-hover:text-amber-300">
                            Favoriler
                        </span>
                    </a>
                    <a href="/Cart/Index" aria-label="Sepet (@cartText Ã¼rÃ¼n)"
                       class="group relative inline-flex items-center gap-2 h-16 px-4 shrink-0 rounded-md
   transition duration-150 cursor-pointer hover:bg-white/5 hover:scale-105
   focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-400">

                        <span class="relative inline-flex">
                            <svg xmlns="http://www.w3.org/2000/svg"
                                 class="h-8 w-8 text-white transition-colors duration-150 group-hover:text-amber-300"
                                 viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                 stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M6.3 5H21L19 12H7.38M20 16H8L6 3H3M9 20a1 1 0 1 1-2 0a1 1 0 0 1 2 0ZM20 20a1 1 0 1 1-2 0a1 1 0 0 1 2 0Z" />
                            </svg>

                            <span id="cart-count-desktop" class="absolute -top-1 -right-1 min-w-[1.25rem] h-5 px-1 rounded-full text-xs font-medium
            bg-amber-300 text-gray-900 grid place-items-center ring-1 ring-black/10
            transition duration-150">
                                @cartText
                            </span>
                        </span>

                        <span class="text-white text-md font-semibold transition-colors duration-150 group-hover:text-amber-300">
                            Sepetim
                        </span>
                    </a>

            </div>
                <!-- Favorites -->
            
            </div>
        </nav>

        <div class="h-20 hidden md:block"></div>

        <div class="bg-gray-800 text-white relative z-40 shadow-xl hidden md:block">
            <div class="mx-auto max-w-7xl px-4">
                <ul class="h-12 flex items-center gap-8 whitespace-nowrap overflow-x-auto md:overflow-visible overflow-y-visible max-h-12">
                    @* GRAND as top-level pills *@
                    @foreach (var grand in categories)
                    {
                        if (grand.SubCategories?.Any() == true)
                        {
                            <li class="relative group">
                                <a class="relative z-30 font-semibold flex items-center gap-1 cursor-pointer
                                               after:content-[''] after:absolute after:left-0 after:-bottom-1 after:h-[2px] after:w-full after:bg-white
                                               after:origin-left after:scale-x-0 after:transition-transform after:duration-300
                                               hover:after:scale-x-100 group-hover:after:scale-x-100 group-focus-within:after:scale-x-100">
                                    @grand.Name
                                    <svg class="w-3 h-3 transition-transform duration-200 group-hover:rotate-180" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" /></svg>
                                </a>

                                @* PARENTS dropdown *@
                                <ul class="absolute left-0 top-full z-20 mt-2 min-w-56 w-max bg-white/95 p-2 text-sm text-gray-900 shadow-lg ring-1 ring-black/5 rounded-xl
                                               font-semibold flex flex-col gap-1 invisible opacity-0 translate-y-1 transition
                                               group-hover:visible group-hover:opacity-100 group-hover:translate-y-0">
                                    @foreach (var parent in grand.SubCategories)
                                    {
                                        <li class="relative group/parent">
                                            <a href="@Url.Action("Index", "Product", new { categoryId = parent.Id })"
                                               class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-gray-100">
                                                <span>@parent.Name</span>
                                                @if (parent.SubCategories?.Any() == true)
                                                {
                                                    <svg class="h-4 w-4 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                        <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11 10l-3.77-3.71a.75.75 0 111.06-1.06l4.24 4.24a.75.75 0 010 1.06l-4.24 4.24a.75.75 0 01-1.06 0z" clip-rule="evenodd" />
                                                    </svg>
                                                }
                                            </a>

                                            @* CHILD flyout *@
                                            @if (parent.SubCategories?.Any() == true)
                                            {
                                                <ul class="absolute top-0 left-full ml-2 min-w-56 rounded-lg border border-gray-200 bg-white shadow-lg z-50 hidden group-hover/parent:block">
                                                    @foreach (var child in parent.SubCategories)
                                                    {
                                                        <li>
                                                            <a href="@Url.Action("Index", "Product", new { categoryId = child.Id })"
                                                               class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-gray-900">
                                                                @child.Name
                                                            </a>
                                                        </li>
                                                    }
                                                </ul>
                                            }
                                        </li>
                                    }
                                </ul>
                            </li>
                        }
                        else
                        {
                            <li>
                                <a href="@Url.Action("Index", "Product", new { categoryId = grand.Id })"
                                   class="relative font-semibold after:absolute after:left-0 after:-bottom-1 after:h-[2px] after:w-full
                                              after:origin-left after:scale-x-0 after:bg-white after:transition-transform after:duration-300
                                              hover:after:scale-x-100">
                                    @grand.Name
                                </a>
                            </li>
                        }
                    }
                    <li>
                        <a href="/Home/Contact"
                           class="relative font-semibold after:absolute after:left-0 after:-bottom-1 after:h-[2px] after:w-full
                              after:origin-left after:scale-x-0 after:bg-white after:transition-transform after:duration-300
                              hover:after:scale-x-100">Ä°letiÅŸim</a>
                    </li>
                </ul>
            </div>
        </div>

    </header>
    <main class="max-w-7xl mx-auto px-4 pt-6 pb-28 md:pb-6">
        @RenderBody()
    </main>
    <nav class="md:hidden fixed inset-x-0 bottom-0 z-50 bg-gray-900 text-white border-t border-white/10" aria-label="Mobil gezinme">
        <div class="max-w-7xl mx-auto px-4">
            <ul class="grid grid-cols-4">
                <li>
                    <a href="/Home/Index" aria-label="Ana sayfa" class="flex flex-col items-center justify-center gap-1 py-3 text-xs font-medium transition-colors duration-150 hover:text-amber-300">
                        <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 10.5 12 3l9 7.5V21a1 1 0 0 1-1 1h-5v-6h-6v6H4a1 1 0 0 1-1-1z" />
                        </svg>
                        <span>Ana sayfa</span>
                    </a>
                 
                </li>
                <li>
                    <a href="/Favorites/Index" aria-label="Favoriler" class="flex flex-col items-center justify-center gap-1 py-3 text-xs font-medium transition-colors duration-150 hover:text-amber-300">
                        <svg class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M11.993 5.09691C11.0387 4.25883 9.78328 3.75 8.40796 3.75C5.42122 3.75 3 6.1497 3 9.10988C3 10.473 3.50639 11.7242 4.35199 12.67L12 20.25L19.4216 12.8944L19.641 12.6631C20.4866 11.7172 21 10.473 21 9.10988C21 6.1497 18.5788 3.75 15.592 3.75C14.2167 3.75 12.9613 4.25883 12.007 5.09692L12 5.08998L11.993 5.09691ZM12 7.09938L12.0549 7.14755L12.9079 6.30208L12.9968 6.22399C13.6868 5.61806 14.5932 5.25 15.592 5.25C17.763 5.25 19.5 6.99073 19.5 9.10988C19.5 10.0813 19.1385 10.9674 18.5363 11.6481L18.3492 11.8453L12 18.1381L5.44274 11.6391C4.85393 10.9658 4.5 10.0809 4.5 9.10988C4.5 6.99073 6.23699 5.25 8.40796 5.25C9.40675 5.25 10.3132 5.61806 11.0032 6.22398L11.0921 6.30203L11.9452 7.14752L12 7.09938Z" />
                        </svg>
                        <span>Favoriler</span>
                    </a>
                </li>
                <li>
                    <a href="/Cart/Index" aria-label="Sepet"
                       class="flex flex-col items-center justify-center gap-1 py-3 text-xs font-medium transition-colors duration-150 hover:text-amber-300">
                        <span class="relative inline-block h-6 w-6 leading-none align-middle">
                            <svg class="h-full w-full block" viewBox="0 0 24 24" fill="none"
                                 stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M6.3 5H21L19 12H7.38M20 16H8L6 3H3M9 20a1 1 0 1 1-2 0a1 1 0 0 1 2 0ZM20 20a1 1 0 1 1-2 0a1 1 0 0 1 2 0Z" />
                            </svg>

                            <span id="cart-count-mobile"
                                  class="absolute -top-1 -right-1 min-w-[1rem] h-4 px-1 rounded-full
                   text-[10px] font-semibold bg-amber-300 text-gray-900
                   grid place-items-center ring-1 ring-black/10">
                                @cartText
                            </span>
                        </span>
                        <span>Sepet</span>
                    </a>
                </li>

                <li>
                    <a href="@accountUrl" aria-label="@accountText" class="flex flex-col items-center justify-center gap-1 py-3 text-xs font-medium transition-colors duration-150 hover:text-amber-300">
                        <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M16 7a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z" />
                            <path d="M4 21v-2a4 4 0 0 1 4-4h8a4 4 0 0 1 4 4v2" />
                        </svg>
                        <span>Profil</span>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
    <footer class="bg-gray-900 text-gray-300 pb-28 md:pb-0" aria-labelledby="site-footer">
        <h2 id="site-footer" class="sr-only">Site alt bilgisi</h2>

        <!-- Main Footer -->
        <div class="mx-auto max-w-7xl px-4 py-12 grid md:grid-cols-4 gap-8">
            <!-- Brand -->
            <div>
                <a href="/" class="inline-flex items-end gap-2 text-white text-xl font-extrabold">
                    <img src="~/img/logo.png" alt="Logo" class="h-16 w-auto object-contain" />
                </a>
                <p class="mt-3 text-sm text-gray-400">
                    Her cihaza doÄŸru gÃ¼Ã§. HÄ±zlÄ± gÃ¶nderim, gÃ¼venli alÄ±ÅŸveriÅŸ.
                </p>
            </div>

            <!-- Shop Links -->
            <div>
                <div class="text-white font-semibold">MaÄŸaza</div>
                <ul class="mt-3 space-y-2 text-sm">
                    <li><a class="hover:underline" href="#">Yeni Gelenler</a></li>
                    <li><a class="hover:underline" href="#">Kategoriler</a></li>
                </ul>
            </div>

            <!-- Support Links -->
            <div>
                <div class="text-white font-semibold">Destek</div>
                <ul class="mt-3 space-y-2 text-sm">
                    <li><a class="hover:underline" href="#">SSS</a></li>
                    <li><a class="hover:underline" href="/Home/Refund">Ä°ade & DeÄŸiÅŸim</a></li>
                    <li><a class="hover:underline" href="#">Kargo Takip</a></li>
                </ul>
            </div>

            <!-- Contact -->
            <div>
                <div class="text-white font-semibold">Ä°letiÅŸim</div>
                <ul class="mt-3 space-y-2 text-sm">
                    <li>Tel: <a href="https://api.whatsapp.com/send/?phone=905013176653" class="underline">+90 501 317 66 53</a></li>
                    <li>E-posta: <a href="mailto:destek@ebs-battery.test" class="underline">yigitdayi4502@gmail.com</a></li>
                    <li>Adres: Ankara, TÃ¼rkiye</li>
                </ul>
            </div>
        </div>
   
        <a href="https://api.whatsapp.com/send/?phone=905013176653"
           target="_blank" rel="noopener"
           class="fixed right-6 bottom-20 md:bottom-6 z-50 flex items-center justify-center w-14 h-14 rounded-full bg-green-500 text-white shadow-lg hover:scale-110 transition">
            <svg class="h-10 w-10" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M16 31C23.732 31 30 24.732 30 17C30 9.26801 23.732 3 16 3C8.26801 3 2 9.26801 2 17C2 19.5109 2.661 21.8674 3.81847 23.905L2 31L9.31486 29.3038C11.3014 30.3854 13.5789 31 16 31ZM16 28.8462C22.5425 28.8462 27.8462 23.5425 27.8462 17C27.8462 10.4576 22.5425 5.15385 16 5.15385C9.45755 5.15385 4.15385 10.4576 4.15385 17C4.15385 19.5261 4.9445 21.8675 6.29184 23.7902L5.23077 27.7692L9.27993 26.7569C11.1894 28.0746 13.5046 28.8462 16 28.8462Z" fill="#BFC8D0"></path> <path d="M28 16C28 22.6274 22.6274 28 16 28C13.4722 28 11.1269 27.2184 9.19266 25.8837L5.09091 26.9091L6.16576 22.8784C4.80092 20.9307 4 18.5589 4 16C4 9.37258 9.37258 4 16 4C22.6274 4 28 9.37258 28 16Z" fill="url(#paint0_linear_87_7264)"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M16 30C23.732 30 30 23.732 30 16C30 8.26801 23.732 2 16 2C8.26801 2 2 8.26801 2 16C2 18.5109 2.661 20.8674 3.81847 22.905L2 30L9.31486 28.3038C11.3014 29.3854 13.5789 30 16 30ZM16 27.8462C22.5425 27.8462 27.8462 22.5425 27.8462 16C27.8462 9.45755 22.5425 4.15385 16 4.15385C9.45755 4.15385 4.15385 9.45755 4.15385 16C4.15385 18.5261 4.9445 20.8675 6.29184 22.7902L5.23077 26.7692L9.27993 25.7569C11.1894 27.0746 13.5046 27.8462 16 27.8462Z" fill="white"></path> <path d="M12.5 9.49989C12.1672 8.83131 11.6565 8.8905 11.1407 8.8905C10.2188 8.8905 8.78125 9.99478 8.78125 12.05C8.78125 13.7343 9.52345 15.578 12.0244 18.3361C14.438 20.9979 17.6094 22.3748 20.2422 22.3279C22.875 22.2811 23.4167 20.0154 23.4167 19.2503C23.4167 18.9112 23.2062 18.742 23.0613 18.696C22.1641 18.2654 20.5093 17.4631 20.1328 17.3124C19.7563 17.1617 19.5597 17.3656 19.4375 17.4765C19.0961 17.8018 18.4193 18.7608 18.1875 18.9765C17.9558 19.1922 17.6103 19.083 17.4665 19.0015C16.9374 18.7892 15.5029 18.1511 14.3595 17.0426C12.9453 15.6718 12.8623 15.2001 12.5959 14.7803C12.3828 14.4444 12.5392 14.2384 12.6172 14.1483C12.9219 13.7968 13.3426 13.254 13.5313 12.9843C13.7199 12.7145 13.5702 12.305 13.4803 12.05C13.0938 10.953 12.7663 10.0347 12.5 9.49989Z" fill="white"></path> <defs> <linearGradient id="paint0_linear_87_7264" x1="26.5" y1="7" x2="4" y2="28" gradientUnits="userSpaceOnUse"> <stop stop-color="#5BD066"></stop> <stop offset="1" stop-color="#27B43E"></stop> </linearGradient> </defs> </g></svg>
        </a>
        <!-- Bottom bar -->
        <div class="border-t border-gray-800">
            <div class="mx-auto max-w-7xl px-4 py-4 flex flex-wrap items-center justify-between gap-4 text-xs">
                <div class="text-gray-400">
                    Â© 2025 Dayily Enerji â€¢ TÃ¼m haklarÄ± saklÄ±dÄ±r.
                </div>
                <div class="flex gap-3">
                    <a href="/Home/Privacy" class="hover:underline">Gizlilik</a>
                    <a href="/Home/Cookies" class="hover:underline">Ã‡erezler</a>
                </div>
            </div>
        </div>
    </footer>

    <div x-data="cookieBanner()"
         x-init="init()"
         x-cloak
         x-show="visible"
         x-transition.opacity.scale
         role="dialog"
         aria-live="assertive"
         aria-label="Ã‡erez bildirimi"
         class="fixed bottom-4 left-4 right-4 z-50 max-w-lg rounded-2xl border border-gray-200 bg-white/95 p-5 shadow-2xl backdrop-blur md:left-auto md:right-6">
        <div class="flex items-start gap-3">
            <div class="flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-amber-100 text-amber-600">
                <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                    <path d="M11 3.055A9 9 0 1 0 21 12h-9V3.055Z" />
                    <path d="M13 3.055V9h5.945A9 9 0 0 0 13 3.055Z" />
                </svg>
            </div>
            <div class="flex-1 space-y-3 text-sm text-gray-700">
                <h2 class="text-lg font-semibold text-gray-900">Ã‡erez tercihleriniz</h2>
                <p x-text="message"></p>
                <p class="text-xs text-gray-500">Sepet ve favoriler gibi Ã¶zellikleri kaydedebilmek iÃ§in Ã§erezleri kullanÄ±yoruz.</p>
            </div>
            <button type="button" aria-label="Kapat" class="text-gray-400 transition hover:text-gray-600" @@click="close()">
                <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="6" y1="6" x2="18" y2="18" />
                    <line x1="6" y1="18" x2="18" y2="6" />
                </svg>
            </button>
        </div>
        <div class="mt-5 flex flex-col gap-2 sm:flex-row sm:justify-end">
            <button type="button"
                    class="inline-flex h-10 items-center justify-center rounded-md bg-amber-300 px-5 text-sm font-semibold text-gray-900 shadow-sm transition hover:bg-amber-400 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-300/60"
                    @@click="accept()">
                Ã‡erezleri kabul et
            </button>
            <button type="button"
                    class="inline-flex h-10 items-center justify-center rounded-md border border-gray-200 px-5 text-sm font-semibold text-gray-700 transition hover:bg-gray-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-200"
                    @@click="reject()">
                Ã‡erezleri reddet
            </button>
        </div>
    </div>
 
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://unpkg.com/htmx.org@1.9.12" defer></script>
    <script src="~/js/layout.js"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
